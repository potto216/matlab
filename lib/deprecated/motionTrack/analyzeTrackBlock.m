%This function analyzes a block of the 1D tracked data and allows the user
%to compare the ir motion data and the individual correlations
%
%Inputs
%caseFile - The case to analyze
%trackFilename - The particular motion track to look at.  If this is empty
%then the assumption is that there is only one motion track.  If not the user
%can select one of the files for processing.
%
function analyzeTrackBlock(caseFile,trackFilename)

switch(nargin)
    case 1
        trackFilename=[];
    case 2
        %do nothing
    otherwise
        error('Invalid number of input arguments.')
end
 

%% Load the data and setup the default regions
[metadata]=loadCaseData(caseFile);
caseStr=getCaseName(metadata);

[roiList,roiOut,mmodeImg]=loadTrackBlock(metadata,trackFilename);

[imH,figH]=showTrackBlock(caseStr,roiList,roiOut,mmodeImg,'legendOption','name');


%% Add buttons to figure to create a GUI
%First add the ability to look at the ir data and the video data
ht = uitoolbar(figH)
b = repmat(IRIcon,[1 1 3]);
hpt = uipushtool(ht,'CData',b,'TooltipString','IR Data Compare','ClickedCallback',{@mouseDownRunIRIcon,caseFile,trackFilename});
b = repmat(videoIcon,[1 1 3]);
hpt = uipushtool(ht,'CData',b,'TooltipString','Video Playback','ClickedCallback',{@mouseDownRunVideoIcon,caseFile,trackFilename});
b = repmat(corrIcon,[1 1 3]);
hpt = uipushtool(ht,'CData',b,'TooltipString','Correlated Data Video','ClickedCallback',{@mouseDownRunCorrIcon,caseFile,trackFilename});


% Add combo box for selecting the roi
hToolbar = findall(figH,'tag','FigureToolBar');
jToolbar = get(get(hToolbar,'JavaContainer'),'ComponentPeer');

%build the string that will be used to id the regions for selection
roiString={};
for ii=1:length(roiList)
    roiString{end+1}=['roi' num2str(ii) ' t(' num2str(roiList(ii).template(1)) ',' num2str(roiList(ii).template(end)) ') s(' num2str(roiList(ii).search(1)) ','  num2str(roiList(ii).search(end)) ')'];
end

if ~isempty(jToolbar)
    
   jCombo = javax.swing.JComboBox(roiString);
%   set(jCombo, 'ActionPerformedCallback', @myUndoCallbackFcn);
   jToolbar(1).add(jCombo,5); %5th position, after printer icon
   jToolbar(1).repaint;
   jToolbar(1).revalidate;
else
    error('Need to be able to access the toolbar');
end   


%set it ready to go
set(imH,'ButtonDownFcn',{@mouseDown,mmodeImg,roiList,roiOut});

end



function IRMat=IRIcon()
IRMat =[ ...
1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1; ...
1  0  0  0  0  0  1  1  1  0  0  0  0  1  1  1; ...
1  1  1  0  1  1  1  1  1  0  1  1  1  0  1  1; ...
1  1  1  0  1  1  1  1  1  0  1  1  1  1  0  1; ...
1  1  1  0  1  1  1  1  1  0  1  1  1  1  0  1; ...
1  1  1  0  1  1  1  1  1  0  1  1  1  0  0  1; ...
1  1  1  0  1  1  1  1  1  0  1  1  0  0  1  1; ...
1  1  1  0  1  1  1  1  1  0  1  0  0  1  1  1; ...
1  1  1  0  1  1  1  1  1  0  0  0  1  1  1  1; ...
1  1  1  0  1  1  1  1  1  0  1  0  0  1  1  1; ...
1  1  1  0  1  1  1  1  1  0  1  1  0  0  1  1; ...
1  1  1  0  1  1  1  1  1  0  1  1  1  0  0  1; ...
1  1  1  0  1  1  1  1  1  0  1  1  1  1  0  0; ...
1  0  0  0  0  0  1  1  1  0  1  1  1  1  1  0; ...
1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1; ...
1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1];

end


function videoMat=videoIcon()
videoMat =[ ...
0  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1; ...
0  0  1  1  1  1  1  1  1  1  1  1  0  0  1  1; ...
1  0  1  1  1  1  1  1  1  1  1  1  0  0  1  1; ...
1  0  0  1  1  1  1  1  1  1  1  0  0  1  1  1; ...
1  0  0  1  1  1  1  1  1  1  0  0  0  1  1  1; ...
1  1  0  1  1  1  1  1  1  1  0  1  0  1  1  1; ...
1  1  0  0  1  1  1  1  1  1  0  0  0  1  1  1; ...
1  1  1  0  1  1  1  1  1  0  0  0  1  1  1  1; ...
1  1  1  0  1  1  1  1  1  0  0  0  1  1  1  1; ...
1  1  1  0  1  1  1  1  0  0  0  1  1  1  1  1; ...
1  1  1  0  0  1  1  1  0  0  0  1  1  1  1  1; ...
1  1  1  0  0  1  1  0  0  0  1  1  1  1  1  1; ...
1  1  1  1  0  1  1  0  0  1  1  1  1  1  1  1; ...
1  1  1  1  0  0  1  0  0  1  1  1  1  1  1  1; ...
1  1  1  1  0  0  0  0  0  1  1  1  1  1  1  1; ...
1  1  1  1  1  0  0  0  0  1  1  1  1  1  1  1];

end


function corrMat=corrIcon()
corrMat =[ ...
0  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1; ...
0  0  1  1  1  1  1  1  1  1  1  1  0  0  1  1; ...
1  0  1  1  1  1  1  1  1  1  1  1  0  0  1  1; ...
1  0  0  1  1  1  1  1  1  1  1  0  0  1  1  1; ...
1  0  0  1  1  1  1  1  1  1  0  0  0  1  1  1; ...
1  1  0  1  1  1  1  1  1  1  0  1  0  1  1  1; ...
1  1  0  0  1  1  1  1  1  1  0  0  0  1  1  1; ...
1  1  1  0  1  1  1  1  1  0  0  0  1  1  1  1; ...
1  1  1  0  1  1  1  1  1  0  0  0  1  1  1  1; ...
1  1  1  0  1  1  1  1  0  0  0  1  1  1  1  1; ...
1  1  1  0  0  1  1  1  0  0  0  1  1  1  1  1; ...
1  1  1  0  0  1  1  0  0  0  1  1  1  1  1  1; ...
1  1  1  1  0  1  1  0  0  1  1  1  1  1  1  1; ...
1  1  1  1  0  0  1  0  0  1  1  1  1  1  1  1; ...
1  1  1  1  0  0  0  0  0  1  1  1  1  1  1  1; ...
1  1  1  1  1  0  0  0  0  1  1  1  1  1  1  1];

end